# JobQuest Navigator v2 - Staging Environment Configuration
# Pre-production staging environment settings

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
ENVIRONMENT=staging
DEBUG=false
PROJECT_NAME=JobQuest Navigator v2 - Staging
VERSION=2.0.0-staging

# Secret key - should be retrieved from AWS Secrets Manager
SECRET_KEY=${AWS_SECRET_MANAGER:jobquest-navigator-v2-staging-app-secret-key}
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# AWS RDS PostgreSQL
DATABASE_URL=postgresql+asyncpg://${DATABASE_USERNAME}:${DATABASE_PASSWORD}@${DATABASE_HOST}:${DATABASE_PORT}/${DATABASE_NAME}
DATABASE_NAME=jobquest_navigator_v2_staging
DATABASE_USERNAME=jobquest_staging_user
DATABASE_PASSWORD=${AWS_SECRET_MANAGER:jobquest-navigator-v2-staging-db-password}
DATABASE_HOST=${TERRAFORM_OUTPUT:rds_endpoint}
DATABASE_PORT=5432

# Connection pool settings
DATABASE_POOL_SIZE=10
DATABASE_POOL_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_PRE_PING=true

# ============================================================================
# CACHE CONFIGURATION (ElastiCache Redis)
# ============================================================================
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
REDIS_HOST=${TERRAFORM_OUTPUT:redis_endpoint}
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Cache TTL settings (seconds)
CACHE_TTL_SHORT=600      # 10 minutes
CACHE_TTL_MEDIUM=1800    # 30 minutes
CACHE_TTL_LONG=3600      # 1 hour

# ============================================================================
# AWS CONFIGURATION
# ============================================================================
AWS_REGION=us-east-1
# IAM role-based access in ECS - no need for explicit keys
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# AWS Cognito (Staging User Pool)
COGNITO_REGION=us-east-1
COGNITO_USER_POOL_ID=${AWS_PARAMETER_STORE:jobquest-staging-cognito-user-pool-id}
COGNITO_CLIENT_ID=${AWS_PARAMETER_STORE:jobquest-staging-cognito-client-id}
COGNITO_APP_CLIENT_ID=${AWS_PARAMETER_STORE:jobquest-staging-cognito-client-id}

# AWS S3 Storage
AWS_STORAGE_BUCKET_NAME=jobquest-navigator-v2-staging-storage
AWS_S3_REGION_NAME=us-east-1
AWS_S3_CUSTOM_DOMAIN=
AWS_S3_FILE_OVERWRITE=false

# ============================================================================
# CORS SETTINGS
# ============================================================================
CORS_ORIGINS=https://staging.jobquest-navigator.com,https://staging-api.jobquest-navigator.com
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=Content-Type,Authorization,X-Requested-With,Accept,Origin

# ============================================================================
# EXTERNAL APIS
# ============================================================================
# OpenAI API for AI features
OPENAI_API_KEY=${AWS_SECRET_MANAGER:jobquest-staging-openai-api-key}

# Adzuna API for job data
ADZUNA_API_ID=${AWS_SECRET_MANAGER:jobquest-staging-adzuna-api-id}
ADZUNA_API_KEY=${AWS_SECRET_MANAGER:jobquest-staging-adzuna-api-key}

# Google Maps API for location features
GOOGLE_MAPS_API_KEY=${AWS_SECRET_MANAGER:jobquest-staging-google-maps-api-key}

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE_ENABLED=false  # Use CloudWatch instead
LOG_CLOUDWATCH_ENABLED=true
LOG_CLOUDWATCH_GROUP=/aws/ecs/jobquest-navigator-v2-staging

# Structured logging
LOG_JSON_FORMAT=true
LOG_INCLUDE_TIMESTAMP=true
LOG_INCLUDE_CORRELATION_ID=true
LOG_INCLUDE_USER_ID=true

# ============================================================================
# STAGING FEATURES
# ============================================================================
# Enable limited development tools for staging
ENABLE_DEBUG_TOOLBAR=false
ENABLE_PROFILING=true
ENABLE_HOT_RELOAD=false

# API Documentation (limited access)
ENABLE_DOCS=true
ENABLE_REDOC=true
DOCS_URL=/docs
REDOC_URL=/redoc

# GraphQL Settings
GRAPHQL_DEBUG=false
GRAPHQL_INTROSPECTION=true
GRAPHQL_PLAYGROUND=false

# ============================================================================
# SECURITY SETTINGS (Staging)
# ============================================================================
# Moderate security settings for staging
SECURE_SSL_REDIRECT=true
SECURE_HSTS_SECONDS=31536000  # 1 year
SECURE_CONTENT_TYPE_NOSNIFF=true
SECURE_BROWSER_XSS_FILTER=true
SECURE_FRAME_DENY=true

# Session settings
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Strict

# CSRF settings
CSRF_COOKIE_SECURE=true
CSRF_TRUSTED_ORIGINS=https://staging.jobquest-navigator.com

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================
# Uvicorn server settings
UVICORN_HOST=0.0.0.0
UVICORN_PORT=8000
UVICORN_RELOAD=false
UVICORN_LOG_LEVEL=info
UVICORN_WORKERS=2
UVICORN_WORKER_CLASS=uvicorn.workers.UvicornWorker
UVICORN_WORKER_CONNECTIONS=1000
UVICORN_MAX_REQUESTS=1000
UVICORN_MAX_REQUESTS_JITTER=50

# Request timeouts
REQUEST_TIMEOUT=30
SLOW_QUERY_THRESHOLD=2.0

# ============================================================================
# MONITORING AND OBSERVABILITY
# ============================================================================
# Metrics collection
ENABLE_METRICS=true
METRICS_ENDPOINT=/metrics
PROMETHEUS_ENDPOINT=http://prometheus.staging.internal:9090

# Health checks
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10

# Distributed tracing
ENABLE_TRACING=true
JAEGER_ENDPOINT=${AWS_PARAMETER_STORE:jobquest-staging-jaeger-endpoint}

# APM (Application Performance Monitoring)
ENABLE_APM=true
SENTRY_DSN=${AWS_SECRET_MANAGER:jobquest-staging-sentry-dsn}
SENTRY_ENVIRONMENT=staging
SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================================================
# EMAIL CONFIGURATION (Staging)
# ============================================================================
# AWS SES for staging
EMAIL_BACKEND=ses
EMAIL_REGION=us-east-1
DEFAULT_FROM_EMAIL=noreply@staging.jobquest-navigator.com

# Email templates
EMAIL_TEMPLATE_DIR=templates/email
EMAIL_SUBJECT_PREFIX=[Staging] 

# ============================================================================
# BACKGROUND TASKS
# ============================================================================
# Celery configuration for staging
CELERY_BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/1
CELERY_RESULT_BACKEND=redis://${REDIS_HOST}:${REDIS_PORT}/2
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Task routing
CELERY_TASK_ROUTES={
    "app.tasks.ai_suggestions": {"queue": "ai_tasks"},
    "app.tasks.email": {"queue": "email_tasks"},
    "app.tasks.data_processing": {"queue": "data_tasks"}
}

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_AI_SUGGESTIONS=true
FEATURE_COMPANY_RESEARCH=true
FEATURE_RESUME_BUILDER=true
FEATURE_JOB_MATCHING=true
FEATURE_SKILLS_ASSESSMENT=true
FEATURE_INTERVIEW_PREP=true

# Experimental features (enabled in staging for testing)
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_AI_COVER_LETTERS=true
FEATURE_SALARY_INSIGHTS=false

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_BURST=20
RATE_LIMIT_STORAGE=redis
RATE_LIMIT_STORAGE_URL=redis://${REDIS_HOST}:${REDIS_PORT}/3

# ============================================================================
# DATA VALIDATION
# ============================================================================
STRICT_VALIDATION=true
ALLOW_TEST_DATA=true
SKIP_EMAIL_VERIFICATION=false

# Data retention
DATA_RETENTION_DAYS=90
LOG_RETENTION_DAYS=30

# ============================================================================
# BACKUP AND RECOVERY
# ============================================================================
ENABLE_AUTOMATED_BACKUPS=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=7

# Point-in-time recovery
ENABLE_PITR=true
PITR_RETENTION_DAYS=7

# ============================================================================
# COMPLIANCE AND AUDITING
# ============================================================================
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_LEVEL=INFO
AUDIT_EVENTS=user_login,user_logout,data_access,data_modification

# GDPR compliance
ENABLE_GDPR_FEATURES=true
DATA_EXPORT_ENABLED=true
DATA_DELETION_ENABLED=true

# ============================================================================
# SCALING CONFIGURATION
# ============================================================================
# Auto-scaling settings
AUTO_SCALE_MIN_CAPACITY=2
AUTO_SCALE_MAX_CAPACITY=10
AUTO_SCALE_TARGET_CPU=70
AUTO_SCALE_TARGET_MEMORY=80

# Database connection limits
MAX_DB_CONNECTIONS=50

# ============================================================================
# TESTING CONFIGURATION
# ============================================================================
# Load testing
ENABLE_LOAD_TEST_ENDPOINTS=false
LOAD_TEST_AUTH_BYPASS=false

# Staging-specific test data
LOAD_SAMPLE_DATA=true
SAMPLE_DATA_COUNT=100

# Mock settings for staging
MOCK_EXTERNAL_APIS=false
MOCK_EMAIL_SENDING=false
MOCK_FILE_UPLOADS=false