# JobQuest Navigator v2 - Production Environment Configuration
# Production environment settings with maximum security and performance

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
ENVIRONMENT=production
DEBUG=false
PROJECT_NAME=JobQuest Navigator v2
VERSION=2.0.0

# Secret key - MUST be retrieved from AWS Secrets Manager
SECRET_KEY=${AWS_SECRET_MANAGER:jobquest-navigator-v2-production-app-secret-key}
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# AWS RDS PostgreSQL with Multi-AZ
DATABASE_URL=postgresql+asyncpg://${DATABASE_USERNAME}:${DATABASE_PASSWORD}@${DATABASE_HOST}:${DATABASE_PORT}/${DATABASE_NAME}
DATABASE_NAME=jobquest_navigator_v2_production
DATABASE_USERNAME=jobquest_prod_user
DATABASE_PASSWORD=${AWS_SECRET_MANAGER:jobquest-navigator-v2-production-db-password}
DATABASE_HOST=${TERRAFORM_OUTPUT:rds_endpoint}
DATABASE_PORT=5432

# Production connection pool settings
DATABASE_POOL_SIZE=20
DATABASE_POOL_MAX_OVERFLOW=50
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_PRE_PING=true
DATABASE_POOL_RECYCLE=3600

# ============================================================================
# CACHE CONFIGURATION (ElastiCache Redis)
# ============================================================================
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
REDIS_HOST=${TERRAFORM_OUTPUT:redis_endpoint}
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Production cache TTL settings (seconds)
CACHE_TTL_SHORT=300      # 5 minutes
CACHE_TTL_MEDIUM=1800    # 30 minutes
CACHE_TTL_LONG=3600      # 1 hour
CACHE_TTL_EXTENDED=86400 # 24 hours

# ============================================================================
# AWS CONFIGURATION
# ============================================================================
AWS_REGION=us-east-1
# Production uses IAM roles - no explicit credentials
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# AWS Cognito (Production User Pool)
COGNITO_REGION=us-east-1
COGNITO_USER_POOL_ID=${AWS_PARAMETER_STORE:jobquest-production-cognito-user-pool-id}
COGNITO_CLIENT_ID=${AWS_PARAMETER_STORE:jobquest-production-cognito-client-id}
COGNITO_APP_CLIENT_ID=${AWS_PARAMETER_STORE:jobquest-production-cognito-client-id}

# AWS S3 Storage
AWS_STORAGE_BUCKET_NAME=jobquest-navigator-v2-production-storage
AWS_S3_REGION_NAME=us-east-1
AWS_S3_CUSTOM_DOMAIN=cdn.jobquest-navigator.com
AWS_S3_FILE_OVERWRITE=false

# CloudFront CDN
AWS_CLOUDFRONT_DOMAIN=cdn.jobquest-navigator.com
AWS_CLOUDFRONT_KEY_PAIR_ID=${AWS_SECRET_MANAGER:jobquest-production-cloudfront-key-pair-id}
AWS_CLOUDFRONT_PRIVATE_KEY=${AWS_SECRET_MANAGER:jobquest-production-cloudfront-private-key}

# ============================================================================
# CORS SETTINGS
# ============================================================================
CORS_ORIGINS=https://jobquest-navigator.com,https://www.jobquest-navigator.com,https://api.jobquest-navigator.com
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=Content-Type,Authorization,X-Requested-With,Accept,Origin

# ============================================================================
# EXTERNAL APIS
# ============================================================================
# OpenAI API for AI features
OPENAI_API_KEY=${AWS_SECRET_MANAGER:jobquest-production-openai-api-key}

# Adzuna API for job data
ADZUNA_API_ID=${AWS_SECRET_MANAGER:jobquest-production-adzuna-api-id}
ADZUNA_API_KEY=${AWS_SECRET_MANAGER:jobquest-production-adzuna-api-key}

# Google Maps API for location features
GOOGLE_MAPS_API_KEY=${AWS_SECRET_MANAGER:jobquest-production-google-maps-api-key}

# LinkedIn API for professional networking
LINKEDIN_CLIENT_ID=${AWS_SECRET_MANAGER:jobquest-production-linkedin-client-id}
LINKEDIN_CLIENT_SECRET=${AWS_SECRET_MANAGER:jobquest-production-linkedin-client-secret}

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=WARNING
LOG_FORMAT=json
LOG_FILE_ENABLED=false  # CloudWatch only
LOG_CLOUDWATCH_ENABLED=true
LOG_CLOUDWATCH_GROUP=/aws/ecs/jobquest-navigator-v2-production

# Structured logging for production
LOG_JSON_FORMAT=true
LOG_INCLUDE_TIMESTAMP=true
LOG_INCLUDE_CORRELATION_ID=true
LOG_INCLUDE_USER_ID=true
LOG_INCLUDE_REQUEST_ID=true
LOG_SANITIZE_SENSITIVE_DATA=true

# Log aggregation
LOG_AGGREGATION_ENDPOINT=${AWS_PARAMETER_STORE:jobquest-production-log-aggregation-endpoint}

# ============================================================================
# PRODUCTION FEATURES
# ============================================================================
# Disable all debug features
ENABLE_DEBUG_TOOLBAR=false
ENABLE_PROFILING=false
ENABLE_HOT_RELOAD=false

# API Documentation (disabled for security)
ENABLE_DOCS=false
ENABLE_REDOC=false
DOCS_URL=
REDOC_URL=

# GraphQL Production Settings
GRAPHQL_DEBUG=false
GRAPHQL_INTROSPECTION=false
GRAPHQL_PLAYGROUND=false

# ============================================================================
# SECURITY SETTINGS (Production)
# ============================================================================
# Maximum security settings
SECURE_SSL_REDIRECT=true
SECURE_HSTS_SECONDS=63072000  # 2 years
SECURE_HSTS_INCLUDE_SUBDOMAINS=true
SECURE_HSTS_PRELOAD=true
SECURE_CONTENT_TYPE_NOSNIFF=true
SECURE_BROWSER_XSS_FILTER=true
SECURE_FRAME_DENY=true

# Session settings
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Strict
SESSION_COOKIE_AGE=1800  # 30 minutes

# CSRF settings
CSRF_COOKIE_SECURE=true
CSRF_COOKIE_HTTPONLY=true
CSRF_TRUSTED_ORIGINS=https://jobquest-navigator.com,https://www.jobquest-navigator.com

# Additional security headers
SECURE_REFERRER_POLICY=strict-origin-when-cross-origin
SECURE_PERMISSIONS_POLICY=geolocation=(), microphone=(), camera=()

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================
# Production Uvicorn settings
UVICORN_HOST=0.0.0.0
UVICORN_PORT=8000
UVICORN_RELOAD=false
UVICORN_LOG_LEVEL=warning
UVICORN_WORKERS=4
UVICORN_WORKER_CLASS=uvicorn.workers.UvicornWorker
UVICORN_WORKER_CONNECTIONS=1000
UVICORN_MAX_REQUESTS=1000
UVICORN_MAX_REQUESTS_JITTER=50

# Request timeouts
REQUEST_TIMEOUT=30
SLOW_QUERY_THRESHOLD=1.0

# Connection limits
MAX_CONCURRENT_REQUESTS=1000
MAX_REQUEST_SIZE=10MB

# ============================================================================
# MONITORING AND OBSERVABILITY
# ============================================================================
# Comprehensive monitoring
ENABLE_METRICS=true
METRICS_ENDPOINT=/metrics
PROMETHEUS_ENDPOINT=${AWS_PARAMETER_STORE:jobquest-production-prometheus-endpoint}

# Health checks
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=5
HEALTH_CHECK_DEPENDENCIES=true

# Distributed tracing
ENABLE_TRACING=true
JAEGER_ENDPOINT=${AWS_PARAMETER_STORE:jobquest-production-jaeger-endpoint}
TRACE_SAMPLING_RATE=0.01  # 1% sampling for production

# APM (Application Performance Monitoring)
ENABLE_APM=true
SENTRY_DSN=${AWS_SECRET_MANAGER:jobquest-production-sentry-dsn}
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.01
SENTRY_PROFILES_SAMPLE_RATE=0.01

# Custom metrics
ENABLE_CUSTOM_METRICS=true
METRICS_RETENTION_DAYS=90

# ============================================================================
# EMAIL CONFIGURATION (Production)
# ============================================================================
# AWS SES for production email
EMAIL_BACKEND=ses
EMAIL_REGION=us-east-1
DEFAULT_FROM_EMAIL=noreply@jobquest-navigator.com

# Email settings
EMAIL_TEMPLATE_DIR=templates/email
EMAIL_SUBJECT_PREFIX=
EMAIL_BOUNCE_HANDLING=true
EMAIL_COMPLAINT_HANDLING=true

# ============================================================================
# BACKGROUND TASKS
# ============================================================================
# Production Celery configuration
CELERY_BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/1
CELERY_RESULT_BACKEND=redis://${REDIS_HOST}:${REDIS_PORT}/2
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Production task routing
CELERY_TASK_ROUTES={
    "app.tasks.ai_suggestions": {"queue": "ai_tasks"},
    "app.tasks.email": {"queue": "email_tasks"},
    "app.tasks.data_processing": {"queue": "data_tasks"},
    "app.tasks.analytics": {"queue": "analytics_tasks"}
}

# Task execution settings
CELERY_TASK_SOFT_TIME_LIMIT=300
CELERY_TASK_TIME_LIMIT=600
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_AI_SUGGESTIONS=true
FEATURE_COMPANY_RESEARCH=true
FEATURE_RESUME_BUILDER=true
FEATURE_JOB_MATCHING=true
FEATURE_SKILLS_ASSESSMENT=true
FEATURE_INTERVIEW_PREP=true

# Premium features
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_AI_COVER_LETTERS=true
FEATURE_SALARY_INSIGHTS=true
FEATURE_PRIORITY_SUPPORT=true

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10
RATE_LIMIT_STORAGE=redis
RATE_LIMIT_STORAGE_URL=redis://${REDIS_HOST}:${REDIS_PORT}/3

# API-specific rate limits
RATE_LIMIT_API_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_AI_REQUESTS_PER_HOUR=100
RATE_LIMIT_UPLOAD_REQUESTS_PER_HOUR=50

# ============================================================================
# DATA VALIDATION
# ============================================================================
STRICT_VALIDATION=true
ALLOW_TEST_DATA=false
SKIP_EMAIL_VERIFICATION=false

# Data retention
DATA_RETENTION_DAYS=2555  # 7 years for compliance
LOG_RETENTION_DAYS=90
SESSION_RETENTION_DAYS=30

# ============================================================================
# BACKUP AND RECOVERY
# ============================================================================
ENABLE_AUTOMATED_BACKUPS=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30

# Point-in-time recovery
ENABLE_PITR=true
PITR_RETENTION_DAYS=7

# Cross-region backup
ENABLE_CROSS_REGION_BACKUP=true
BACKUP_CROSS_REGION=us-west-2

# ============================================================================
# COMPLIANCE AND AUDITING
# ============================================================================
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_LEVEL=INFO
AUDIT_EVENTS=all

# GDPR compliance
ENABLE_GDPR_FEATURES=true
DATA_EXPORT_ENABLED=true
DATA_DELETION_ENABLED=true
COOKIE_CONSENT_REQUIRED=true

# SOC2 compliance
ENABLE_SOC2_FEATURES=true
ACCESS_LOG_RETENTION_DAYS=365

# ============================================================================
# SCALING CONFIGURATION
# ============================================================================
# Auto-scaling settings
AUTO_SCALE_MIN_CAPACITY=3
AUTO_SCALE_MAX_CAPACITY=20
AUTO_SCALE_TARGET_CPU=70
AUTO_SCALE_TARGET_MEMORY=80

# Database scaling
MAX_DB_CONNECTIONS=100
READ_REPLICA_ENABLED=true

# CDN and caching
CDN_CACHE_TTL=86400  # 24 hours
BROWSER_CACHE_TTL=3600  # 1 hour

# ============================================================================
# DISASTER RECOVERY
# ============================================================================
ENABLE_DISASTER_RECOVERY=true
DR_REGION=us-west-2
DR_RTO=4  # Recovery Time Objective: 4 hours
DR_RPO=1  # Recovery Point Objective: 1 hour

# ============================================================================
# TESTING CONFIGURATION
# ============================================================================
# Production - no test features
ENABLE_LOAD_TEST_ENDPOINTS=false
LOAD_TEST_AUTH_BYPASS=false
LOAD_SAMPLE_DATA=false
SAMPLE_DATA_COUNT=0

# No mocking in production
MOCK_EXTERNAL_APIS=false
MOCK_EMAIL_SENDING=false
MOCK_FILE_UPLOADS=false

# ============================================================================
# BUSINESS METRICS
# ============================================================================
ENABLE_ANALYTICS=true
ANALYTICS_RETENTION_DAYS=365
ENABLE_A_B_TESTING=true
ENABLE_USER_TRACKING=true

# Revenue tracking
ENABLE_REVENUE_TRACKING=true
PAYMENT_PROVIDER=stripe
STRIPE_PUBLIC_KEY=${AWS_SECRET_MANAGER:jobquest-production-stripe-public-key}
STRIPE_SECRET_KEY=${AWS_SECRET_MANAGER:jobquest-production-stripe-secret-key}